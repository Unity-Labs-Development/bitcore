<ion-grid>
  <ion-row>
    <ion-col col-7>
      <div class="ellipsis">
        <span *ngIf="showCoins">
          <ion-icon name="add-circle" [hidden]="expanded" (click)="toggleExpanded()"></ion-icon>
          <ion-icon name="remove-circle" [hidden]="!expanded" (click)="toggleExpanded()"></ion-icon>
        </span>
        <span>
          <a (click)="goToTx(tx.txid)">{{ tx.txid }}</a>
        </span>
      </div>
    </ion-col>
    <ion-col col-5 text-right>
      <ion-note [hidden]="!tx.firstSeenTs">
        <span translate>first seen at</span>
        <time>{{ tx.firstSeenTs * 1000 | date:'medium' }}</time>
      </ion-note>
      <!-- <ion-note [hidden]="!tx.blocktime && tx.firstSeenTs"> -->
      <ion-note>
        <span translate>mined</span>
        <time>{{ tx.time * 1000 | date:'MMM d, y' }}</time>
        <time>{{ tx.time * 1000 | date:'hh:mm:ss a' }}</time>
      </ion-note>
    </ion-col>
  </ion-row>

  <ion-row align-items-end class="small" *ngIf="!showCoins">
    <ion-col col-12 text-right text-uppercase>
      <ion-chip item-end color="danger" *ngIf="tx.confirmations === -3">
        <ion-label>
          无效
        </ion-label>
      </ion-chip>
      <ion-chip item-end color="warning" *ngIf="tx.confirmations === -1">
        <ion-label>
          未确认
        </ion-label>
      </ion-chip>
      <ion-chip item-end color="primary" *ngIf="tx.confirmations === 1">
        <ion-label>
          1 确认数
        </ion-label>
      </ion-chip>
      <ion-chip item-end color="primary" *ngIf="tx.confirmations > 1">
        <ion-label>
          {{ tx.confirmations }} 确认数
        </ion-label>
      </ion-chip>
      <ion-chip item-end color="navy-blue">
        <ion-label>
          {{ currencyProvider.getConvertedNumber(tx.valueOut) | number:'1.0-8' }} {{ currencyProvider.currencySymbol }}
        </ion-label>
      </ion-chip>
    </ion-col>
  </ion-row>

  <ion-row *ngIf="showCoins" align-items-start>
    <ion-col col-12 col-md-5>

      <ion-list [hidden]="!tx.isCoinBase">
        <ion-item>
          没有输入 (新生成的币种)
        </ion-item>
      </ion-list>

      <!-- <ion-list [hidden]="tx.isCoinBase"> -->
      <ion-list>
        <ion-item *ngFor="let vin of aggregateItems(tx.vin); let i = index ">
          <button item-start ion-button *ngIf="expanded" (click)="goToTx(vin.items[i].mintTxid, i, false)" clear
            icon-only>
            <ion-icon color="primary" name="ios-arrow-forward"></ion-icon>
          </button>

          <div class="ellipsis">
            <p>
              <a (click)="goToAddress(vin.address)"
                [ngClass]="{'disabled-link': getAddress(vin) === 'Unparsed address' }">{{ getAddress(vin) }}</a>
            </p>
          </div>
          <!-- <div [hidden]="!expanded"> -->
          <div>
            <p *ngIf="tx.confirmations > 0">
              <b>确认数</b> {{ tx.confirmations }}</p>
            <p>
              <b>Unlocking Script</b>
            </p>
            <div *ngFor="let item of vin.items">
              <div *ngIf="item.scriptSig">
                <div class="unlocking-script">
                  <p>{{ item.scriptSig.asm }}
                </div>
              </div>
            </div>
          </div>

          <div item-end>
            {{ vin.value | number:'1.0-8' }} {{ currencyProvider.currencySymbol }}
          </div>
        </ion-item>
      </ion-list>

    </ion-col>

    <ion-col col-12 col-md-1 text-center class="arrow-forward">
      <ion-icon name="arrow-forward"></ion-icon>
    </ion-col>

    <ion-col col-12 col-md-6>
      <ion-list>
        <ion-item *ngFor="let vout of tx.vout; let i = index">
          <div>
            <div class="ellipsis">
              <p>
                <a [ngClass]="{'disabled-link': getAddress(vout) === 'Unparsed address' }"
                  (click)="goToAddress(vout.address)">{{ getAddress(vout) }}</a>
              </p>
            </div>
            <div *ngIf="expanded">
              <p>
                <b>Script Template</b>
                <i>{{ vout.script.type }}</i>
              </p>
              <p>
                <b>Locking Script</b>
              </p>
              <div class="locking-script">
                <p>{{ vout.script.asm }}</p>
              </div>
            </div>
          </div>

          <div item-end>
            {{ currencyProvider.getConvertedNumber(vout.value) | number:'1.0-8' }} {{ currencyProvider.currencySymbol }}
            <span>(S)</span>
            <span>(U)</span>
            <!-- <span [hidden]="!vout.spentTxid">(S)</span>
            <span [hidden]="vout.spentTxid">(U)</span> -->
          </div>

          <button item-end ion-button *ngIf="expanded && vout.spentTxid && vout.spentTxid !== '' " (click)="
            goToTx(vout.spentTxid, i, true)" clear icon-only>
            <ion-icon color="primary" name="ios-arrow-forward"></ion-icon>
          </button>
        </ion-item>
      </ion-list>
    </ion-col>
  </ion-row>

  <ion-row align-items-start text-uppercase class="small" *ngIf="showCoins">
    <ion-col col-6>
      <div *ngIf="!tx.isCoinBase && tx.fees >= 0">
        <ion-chip>
          <ion-label>费用
            <span text-nowrap>{{ tx.fees }}
              {{ currencyProvider.currencySymbol }}</span>
          </ion-label>
        </ion-chip>
      </div>
    </ion-col>
    <ion-col col-6 text-right>
      <ion-chip color="danger" *ngIf="tx.confirmations === -3">
        <ion-label>无效</ion-label>
      </ion-chip>
      <ion-chip color="warning" *ngIf="tx.confirmations === -1">
        <ion-label>未确认</ion-label>
      </ion-chip>
      <ion-chip color="brand" *ngIf="tx.confirmations === 1">
        <ion-label>1 确认数</ion-label>
      </ion-chip>
      <ion-chip color="primary" *ngIf="tx.confirmations > 1">
        <ion-label>{{ tx.confirmations }} 确认数
        </ion-label>
      </ion-chip>
      <ion-chip color="navy-blue">
        <ion-label>{{ currencyProvider.getConvertedNumber(tx.valueOut) | number:'1.0-8' }}
          {{ currencyProvider.currencySymbol }}
        </ion-label>
      </ion-chip>
    </ion-col>
  </ion-row>
</ion-grid>
